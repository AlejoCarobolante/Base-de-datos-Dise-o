
#  Base de Datos - Migraciones

¬°Bienvenidos al repositorio de migraciones de la base de datos!  
Este proyecto pertenece al grupo **Hologram** del curso **Dise√±o de Sistemas 2025** üöÄ

![Logo ](files/logo.png)

---

## üìÑ Descripci√≥n

Aqu√≠ encontrar√°s todas las **migraciones** necesarias para crear y actualizar la base de datos de nuestro proyecto.  
Estas migraciones aseguran que todos los miembros del grupo **Hologram** trabajemos con la misma estructura de datos üóÇÔ∏è

---

## üóÇÔ∏è Contenido

- üîπ Migraciones de tablas principales  
- üîπ Scripts de actualizaci√≥n  
- üîπ Configuraci√≥n inicial de la base de datos  

---

## ‚ö° C√≥mo usar

1. Clona el repositorio:
   ```bash
   git clone https://github.com/AlejoCarobolante/Base-de-datos-Dise-o.git
   cd Base-de-datos-Dise-o
2. Ejecuta las migraciones seg√∫n tu framework:

    La manera m√°s sencilla es importar el archivo COPIA_BD_ALEJO.sql directamente en la BD
    Tambi√©n es posible abrir el archivo con el bloc de notas, copiar su contenido y ejecutar el script completo en una editor de SQL

## üë• Grupo

* Grupo: Hologram

* Curso: Dise√±o de Sistemas 2025

* Objetivo: Mantener la base de datos sincronizada y organizada para todos los miembros del grupo üéØ

## ü§ù Contribuciones

Si quieres ayudar o proponer mejoras, coordina con los miembros del grupo Hologram antes de hacer un pull request ‚ú®

### üèóÔ∏è Estructura de carpetas
Base-de-datos-Dise-o/
‚îÇ
‚îú‚îÄ‚îÄ migrations/       # Migraciones de la base de datos
‚îú‚îÄ‚îÄ scripts/          # Scripts adicionales
‚îî‚îÄ‚îÄ README.md         # Este archivo

## üé® Nota

Este repositorio est√° pensado para aprender, compartir y mantener la base de datos de forma divertida y ordenada.
¬°A disfrutar del c√≥digo y las migraciones! üíªüéà

### üõ†Ô∏è Requisitos

Docker
    MySQL pulleado

Sistema Gestor de Base de Datos

Base de datos MySQL/PostgreSQL

Permisos de ejecuci√≥n para scripts de migraci√≥n

![The Boss ](files/tanen.png)

# Funcionalidades implementadas en las migraciones

## Constraints
* Se implementan restricciones al momento de la creaci√≥n de entidades intermedias:
    1. Se establece que las claves (que a nivel de claves de negocio son compuestas) son √∫nicas, por lo cual no va a haber dos instancias de una tabla intermedia relacionadas a las mismas instancias de tablas del negocio:
        * ProyectoPuesto: UNIQUE (OIDProyecto, OIDPuesto)
        * ProyectoPuestoCarrera UNIQUE (OIDProyectoPuesto, OIDCarrera, OIDCarreraPlanEstudios)
        * EstudianteCarrera UNIQUE (OIDEstudiante, OIDCarrera, OIDCarreraPlanEstudios, OIDEstudianteUniversidad, OIDCarreraUniversidad)
        * EstudianteUniversidad UNIQUE (OIDEstudiante, OIDUniversidad)
        * ProcesoSeleccionPostulacion UNIQUE (OIDProcesoSeleccionProyectoPuesto, OIDPostulacion)
        * ProcesoSeleccionProyectoPuesto UNIQUE (OIDProcesoSeleccion, OIDProyectoPuesto)
        * CarreraUniversidad UNIQUE (OIDCarrera, OIDUniversidad)
        * ProyectoUniversidad UNIQUE (OIDProyecto, OIDUniversidad)


## Triggers de la Base de Datos

Este documento describe los triggers implementados en la base de datos, su prop√≥sito y comportamiento.

---

### 1. Triggers de "baja" de entidades

Estos triggers evitan que se vuelva a dar de baja una entidad si ya tiene una fecha de baja registrada.

| Trigger | Tabla | Descripci√≥n |
|---------|-------|-------------|
| `trg_check_baja_carrera` | Carrera | Evita volver a dar de baja una carrera si `fechaBajaCarrera` no cambia. |
| `trg_check_baja_planestudio` | CarreraPlanEstudios | Evita volver a dar de baja un plan de estudios si `fechaBajaPlanEstudio` no cambia. |
| `trg_check_baja_empresa` | Empresa | Evita volver a dar de baja una empresa si `fechaBajaEmpresa` no cambia. |
| `trg_check_baja_estadocontrato` | EstadoContrato | Evita volver a dar de baja un estado de contrato. |
| `trg_check_baja_estadoestudiantecarrera` | EstadoEstudianteCarrera | Evita volver a dar de baja el estado de un estudiante en una carrera. |
| `trg_check_baja_estadopostulacion` | EstadoPostulacion | Evita volver a dar de baja un estado de postulaci√≥n. |
| `trg_check_baja_estadoprocesoseleccion` | EstadoProcesoSeleccion | Evita volver a dar de baja un estado de proceso de selecci√≥n. |
| `trg_check_baja_estadoproyecto` | EstadoProyecto | Evita volver a dar de baja un estado de proyecto. |
| `trg_check_baja_estudiante` | Estudiante | Evita volver a dar de baja un estudiante. |
| `trg_check_baja_proyectopuesto` | ProyectoPuesto | Evita volver a dar de baja un proyecto puesto. |
| `trg_check_baja_proyectopuestocarrera` | ProyectoPuestoCarrera | Evita volver a dar de baja un proyecto puesto-carrera. |
| `trg_check_baja_puesto` | Puesto | Evita volver a dar de baja un puesto. |
| `trg_check_baja_universidad` | Universidad | Evita volver a dar de baja una universidad. |

---

### 2. Triggers de validaci√≥n de postulaciones

| Trigger | Tabla | Descripci√≥n |
|---------|-------|-------------|
| `trg_validar_postulacion_cant_materias` | Postulacion (INSERT) | Valida que el estudiante cumpla la cantidad m√≠nima de materias aprobadas y regulares requeridas. |
| `trg_ValidarMaxPostulaciones` | Postulacion (INSERT) | Verifica que el n√∫mero de postulaciones a un puesto no exceda el m√°ximo permitido. |
| `trg_ValidarEstadoProyectoParaPostulacion` | Postulacion (INSERT) | Solo permite postulaciones a proyectos en estado 2 (activo). |
| `trg_AutoActualizarEstadoProyecto` | Postulacion (AFTER INSERT) | Actualiza el proyecto a estado 3 (iniciado) si todos los puestos cumplen la cantidad correcta de postulaciones. |
| `trg_check_estado_postulacion` | PostulacionEstado (INSERT) | Valida que los cambios de estado de una postulaci√≥n sean v√°lidos, no repetidos y dentro del flujo permitido. |
| `trg_check_estado_proceso_postulacion` | ProcesoSeleccionEstado (UPDATE) | Valida que los cambios de estado de un proceso de selecci√≥n sean v√°lidos y respeten el flujo permitido. |

---

### 3. Triggers de validaci√≥n y control de proyectos

| Trigger | Tabla | Descripci√≥n |
|---------|-------|-------------|
| `trg_check_creacion_proyecto` | Proyecto (INSERT) | Asigna estado 1 (creado) si no se especifica y valida que el proyecto se cree solo en estado 1. |
| `trg_check_estado_proyecto` | Proyecto (UPDATE) | Valida las transiciones de estado del proyecto y evita repetici√≥n del mismo estado. |
| `trg_check_iniciar_proyecto_pp_ppc_notnull` | Proyecto (UPDATE) | Antes de iniciar un proyecto (estado 2), verifica que haya al menos un ProyectoPuesto y ProyectoPuestoCarrera activos. |
| `trg_ValidarCambioEstadoProyecto` | Proyecto (UPDATE) | Solo permite pasar a estado 3 si todos los puestos cumplen la cantidad de postulaciones necesarias. En caso de no cumplirse, la fecha de inicio del Proyecto se posterga una semana. |
| `trg_check_creacion_proyecto` | Proyecto (UPDATE) | Cuando se hace inicia el Proyecto (OIDEstadoProyecto  2), la fechaInicioPostulaciones se define autom√°ticamente como la fecha actual. |

---

### 4. Triggers de ProyectoPuesto y ProyectoPuestoCarrera

| Trigger | Tabla | Descripci√≥n |
|---------|-------|-------------|
| `trg_proyectopuesto_insert_proyecto_creado` | ProyectoPuesto (INSERT) | Solo permite crear un ProyectoPuesto si el proyecto est√° en estado 1 (creado). |
| `trg_proyectopuesto_update_proyecto_creado` | ProyectoPuesto (UPDATE) | Solo permite modificar un ProyectoPuesto si el proyecto est√° en estado 1 (creado). |
| `trg_evitar_proyectopuestocarrera_con_carrera_baja` | ProyectoPuestoCarrera (INSERT) | Impide crear un ProyectoPuestoCarrera si la carrera est√° dada de baja. |
| `trg_asignar_plan_estudios_vigente` | ProyectoPuestoCarrera (INSERT) | Asigna autom√°ticamente el plan de estudios vigente si no se especifica. |
| `trg_proyectopuestocarrera_insert_proyecto_alta` | ProyectoPuestoCarrera (INSERT) | Solo permite crear un ProyectoPuestoCarrera si el proyecto est√° en estado 1 (creado). |
| `trg_proyectopuestocarrera_update_proyecto_alta` | ProyectoPuestoCarrera (UPDATE) | Solo permite modificar un ProyectoPuestoCarrera si el proyecto est√° en estado 1 (creado). |

---

#### Resumen general

- Los triggers de **baja** previenen duplicaciones de baja en las entidades.  
- Los triggers de **postulaci√≥n** validan requisitos de materias, estados de proyectos y transiciones de estado.  
- Los triggers de **proyectos y puestos** controlan la creaci√≥n, modificaci√≥n y transici√≥n de estados, asegurando consistencia en los datos relacionados (puestos, carreras, planes de estudios).  
